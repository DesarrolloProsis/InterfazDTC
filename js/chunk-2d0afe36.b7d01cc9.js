(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0afe36"],{"0ff0":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"justify-center"},[e.modalImage?t("div",{staticClass:"sticky inset-0",class:{"modal-container":e.modalImage}},[t("div",{staticClass:"modalCargarImg sm:mt-34 sm:m-4 md:mt-66 mt-66"},[t("span",{staticClass:"absolute top-0 right-0",on:{click:e.cerrar_modal_imagenes}},[t("font-awesome-icon",{staticClass:"h-8 cursor-pointer sm:w-6 sm:h-6 text-blue-800",attrs:{icon:"fa-regular fa-circle-xmark"}})],1),t("div",{staticClass:"justify-center text-center block"},[t("ImagenesFichaDiagnostico",{attrs:{reporteDataInsertada:!0,tipo:"Diagnostico",referenceNumber:void 0!=e.datosHeader.referenceNumber?e.datosHeader.referenceNumber:""},on:{"bloquear-boton-diagnostico":e.bloquear_boton_diagnostioc_img}}),t("button",{staticClass:"botonIconCrear mt-6",class:{"bg-gray-300 hover:text-black border-black hover:border-black cursor-not-allowed opacity-50":e.blockBotonModal,"hover:bg-gray-300 hove:border-black":e.blockBotonModal},attrs:{disabled:e.blockBotonModal},on:{click:function(t){return e.enviar_header_diagnostico(!1)}}},[t("font-awesome-icon",{staticClass:"mr-2 text-green-800 h-8",attrs:{icon:"fa-solid fa-file-circle-plus"}}),t("span",[e._v("Generar Diagnóstico")])],1)],1)])]):e._e(),t("div",{staticClass:"grid gap-4 grid-cols-1 py-3 px-3 sm:-ml-2 sm:px-2"},[t("div",{staticClass:"mt-1 mb-16 sm:block sm:p-1 sm:pr-6 border sm:m-1 shadow-md grid grid-cols sm:mb-20"},[t("h1",{staticClass:"text-black text-center -ml-30 text-4xl mt-3 mb-1 sm:mb-1 sm:mx-auto sm:text-2xl md:mx-auto xl:mx-auto font-titulo font-bold"},[e._v("Diagnóstico de Falla")]),t("HeaderFalla",{attrs:{tipo:"DIAG",reporteInsertado:e.reporteInsertado},on:{"actualizar-header":e.actualizar_header}}),"Editar"==e.$route.params.tipoVista||0==e.botonEditCreate?t("ImagenesFichaDiagnostico",{attrs:{reporteDataInsertada:!0,tipo:e.type,referenceNumber:void 0!=e.datosHeader.referenceNumber?e.datosHeader.referenceNumber:""}}):e._e(),t("div",{staticClass:"mb-5 -mt-10 ml-77 sm:mb-6 sm:mx-6 sm:-mt-16 md:mx-auto md:mb-18 lg:mx-auto xl:mx-auto"},["Crear"==e.$route.params.tipoVista&&1==e.botonEditCreate?t("div",[e.modalImage?e._e():t("button",{staticClass:"botonIconCrear",on:{click:function(t){return e.enviar_header_diagnostico(!0)}}},[t("font-awesome-icon",{staticClass:"mr-2 text-green-800 h-8",attrs:{icon:"fa-solid fa-file-circle-plus"}}),t("span",[e._v("Enviar Información del Diagnóstico")])],1)]):t("div",[t("button",{staticClass:"botonIconActualizar sm:mt-12",on:{click:function(t){return e.enviar_header_diagnostico(!0)}}},[t("font-awesome-icon",{staticClass:"mr-2 text-yellow-600 h-8",attrs:{icon:"fa-solid fa-file-pen"}}),t("span",[e._v("Actualizar Diagnóstico")])],1)])]),t("Spinner",{attrs:{modalLoading:e.modalLoading}})],1)])])])},i=[],r=a("5530"),s=(a("99af"),a("ac1f"),a("1276"),a("d81d"),a("d3b7"),a("159b"),a("4669")),n=a("9909"),c=a("ccc9"),d=a("225c"),l=a("11b3"),m=a("c1df"),u=a.n(m),h="http://201.99.110.3:86/api",f={name:"Diagnostico",components:{HeaderFalla:s["a"],ImagenesFichaDiagnostico:c["a"],Spinner:d["a"]},data:function(){return{datosHeader:{},itemCompletoEdit:{},type:"Diagnostico",reporteInsertado:!1,modalImage:!1,botonEditCreate:!0,blockBotonModal:!1,modalLoading:!1}},beforeMount:function(){this.$store.dispatch("Login/BUSCAR_ADMIN_PLAZA"),"Editar"==this.$route.params.tipoVista&&(this.itemCompletoEdit=this.$route.query.item,this.reporteInsertado=!0,this.botonEditCreate=!1)},methods:{bloquear_boton_diagnostioc_img:function(e){this.blockBotonModal=e},actualizar_header:function(e){var t=this;this.datosHeader=e.header,0==e.value?(this.modalLoading=!0,this.$http.get("".concat(h,"/DiagnosticoFalla/Images/GetPaths/").concat(e.header.referenceNumber.split("-")[0],"/").concat(e.header.referenceNumber)).then((function(a){a.data.length>0?(e.crear&&t.insertar_diagnostico_falla(e.value),t.modalLoading=!1):t.$notify.warning({title:"Ops!!",class:"font-titulo",msg:"SE NECESITA MINIMO UNA FOTO.",position:"bottom right",styles:{height:100,width:500}})}))):e.crear&&(this.modalLoading=!0,0==this.botonEditCreate?this.$http.get("".concat(h,"/DiagnosticoFalla/Images/GetPaths/").concat(e.header.referenceNumber.split("-")[0],"/").concat(e.header.referenceNumber)).then((function(a){a.data.length>0?(t.insertar_diagnostico_falla(e.value),t.modalLoading=!1):t.$notify.warning({title:"Ops!!",class:"font-titulo",msg:"SE NECESITA MINIMO UNA FOTO.",position:"bottom right",styles:{height:100,width:500}})})):this.insertar_diagnostico_falla(e.value))},enviar_header_diagnostico:function(e){l["a"].$emit("validar_header_diagnostico",e)},cerrar_modal_imagenes:function(){this.modalImage=!1,this.botonEditCreate=!1},insertar_diagnostico_falla:function(e){var t=this;if(e){var a=this.$store.getters["Login/GET_USEER_ID_PLAZA_ID"],o=this.$store.state.Login.plazaSelecionada.administradorId,i="Editar"==this.$route.params.tipoVista?0:1;i=0==this.botonEditCreate?0:1;var s=u()(this.datosHeader.horaInicio).format("DD-MM-YYYY HH:mm:ss"),c=u()(this.datosHeader.horaFin).format("DD-MM-YYYY HH:mm:ss"),d={referenceNumber:this.datosHeader.referenceNumber,squareId:a.numPlaza,diagnosisDate:this.datosHeader.fechaDiagnostico,start:s,end:c,sinisterNumber:this.datosHeader.numeroReporte,failureNumber:this.datosHeader.folioFalla,userId:a.idUser,failureDescription:this.datosHeader.descripcionFalla,failureDiagnosis:this.datosHeader.diagnosticoFalla,causeFailure:this.datosHeader.causaFalla,adminSquareId:o,updateFlag:i};this.$http.post("".concat(h,"/DiagnosticoFalla/InsertDiagnosticoDeFalla/").concat(d.referenceNumber.split("-")[0]),d).then((function(){var e=t.$route.query.referenceNumberFinishDiagnostic;void 0!=e&&t.$http.put("".concat(h,"/DtcData/UpdateDtcDFReference/").concat(d.referenceNumber.split("-")[0],"/").concat(e,"/").concat(d.referenceNumber)).then((function(){t.modalLoading=!1,t.$notify.success({title:"Ok!",class:"font-titulo",msg:"SE INSERTO EL DIAGNOSTICO AL DTC CON REFERENCIA ".concat(e,"."),position:"bottom right",styles:{height:100,width:500}})}));var a=t.datosHeader.ubicacion.map((function(e){var t={};return t["referenceNumber"]=d.referenceNumber,t["capuLaneNum"]=e.capufeLaneNum,t["idGare"]=e.idGare,t["addFlag"]=1,t})),o=Object(r["a"])({},a[0]);o["addFlag"]=0,t.$http.post("".concat(h,"/DiagnosticoFalla/FichaTecnicaDiagnosticoLane/").concat(d.referenceNumber.split("-")[0]),o).then((function(){a.forEach((function(e){t.$http.post("".concat(h,"/DiagnosticoFalla/FichaTecnicaDiagnosticoLane/").concat(d.referenceNumber.split("-")[0]),e).then((function(){0!=t.botonEditCreate&&(t.modalLoading=!1,t.modalImage=!0)}))})),setTimeout((function(){if("Editar"==t.$route.params.tipoVista){t.modalLoading=!0,t.type="Ficha",t.modalImage=!1,n["a"].generar_pdf_diagnostico_falla(t.datosHeader.referenceNumber),t.datosHeader["tipoFalla"]=t.itemCompletoEdit.typeFaultId,t.datosHeader["solucionFalla"]=t.itemCompletoEdit.intervention;var e=t.$route.query.referenciaDtc;t.$router.push({path:"FichaTecnicaDeFalla",query:{data:t.datosHeader,referenciaDtc:e}})}else if(0==t.botonEditCreate){t.type="FICHA",n["a"].generar_pdf_diagnostico_falla(t.datosHeader.referenceNumber);var a=t.$route.query.referenciaDtc,o=t.$route.query.referenceNumberFinishDiagnostic;t.$router.push({path:"FichaTecnicaDeFalla",query:{data:t.datosHeader,referenciaDtc:a,referenceNumberFinishDiagnostic:o}})}}),2e3)})),t.reporteInsertado=!0})).catch((function(){console.log("catch"),t.$notify.warning({title:"Ops!!",msg:"NO SE PUDO INSERTAR EL DIAGNOSTICO, PORFAVOR VERIFIQUE SUS DATOS.",position:"bottom right",styles:{height:100,width:500}})}))}else{this.type="FICHA",n["a"].generar_pdf_diagnostico_falla(this.datosHeader.referenceNumber);var l=this.$route.query.referenciaDtc,m=this.$route.query.referenceNumberFinishDiagnostic;this.$router.push({path:"FichaTecnicaDeFalla",query:{data:this.datosHeader,referenciaDtc:l,referenceNumberFinishDiagnostic:m}})}}}},g=f,p=a("2877"),b=Object(p["a"])(g,o,i,!1,null,null,null);t["default"]=b.exports}}]);
//# sourceMappingURL=chunk-2d0afe36.b7d01cc9.js.map